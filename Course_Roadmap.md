# 西班牙语课程优化路线图 (Spanish Course Optimization Roadmap)

---

## 课程体系规划 (A1-B1)

### **总体思路:**
我们的目标是用4节大课，引导学生从0基础（A1）入门，逐步过渡到能够进行独立沟通（B1）的水平。每节课都将围绕一个核心主题展开，并在主题下融合语法、词汇和实际应用。

- **第一课 (已完成):** `你好，世界！` (A1入门) - 核心是身份认同和进行最基础的自我介绍。
- **第二课 (规划中):** `我的日常生活` (完成A1, 迈向A2) - 核心是描述常规活动、喜好和身边环境。
- **第三课 (规划中):** `过去的故事` (A2核心) - 核心是学习叙述过去发生的事情，这是语言能力的一大飞跃。
- **第四课 (规划中):** `未来的计划与假设` (B1入门) - 核心是表达观点、计划、建议和想象中的情景。

---

### **课程规划详情**

#### **第二课: 我的日常生活 (Mi día a día)**
- **目标**: 完成A1阶段，开始进入A2。学生将能详细描述个人生活、日程、喜好和周围环境。
- **核心语法 (Gramática Clave):**
    1.  **动词强化**:
        -   系统学习**现在时**规则动词变位 (`-ar`, `-er`, `-ir`)。
        -   引入核心不规则动词 **Estar** (状态、位置), **Tener** (拥有), **Ir** (去)。
        -   深入学习 **Ser vs. Estar** 的区别。
    2.  **重要句型**:
        -   `Gustar` (及类似动词) 的用法，表达喜好 (e.g., *Me gusta el café*)。
        -   `Hay` 的用法 (e.g., *En mi oficina hay tres mesas*)。
        -   情态动词 `poder` (能够), `querer` (想要), `tener que` (必须)。
    3.  **代词入门**: 引入**直接宾语代词** (`lo`, `la`, `los`, `las`)，使表达更地道 (e.g., *¿Lees el libro? -> Sí, lo leo.*)。
    4.  **反身动词**: 学习日常作息相关的动词 (e.g., `levantarse`, `ducharse`)。
- **核心词汇 (Vocabulario Clave):**
    -   **日常生活**: 工作日、周末、日程安排、时间点。
    -   **地点与交通**: 办公室、家、城市、交通工具。
    -   **食物与饮料**: 一日三餐、餐厅点餐常用语。
    -   **爱好与活动**: 运动、音乐、电影、阅读。

#### **第三课: 过去的故事 (Historias del pasado)**
- **目标**: 掌握A2核心能力。学生将能叙述和讨论过去发生的具体事件、经历和背景故事。
- **核心语法 (Gramática Clave):**
    1.  **两大过去时态**:
        -   **简单过去时 (Pretérito Indefinido)**: 用于叙述已经完成的、具体的过去动作 (e.g., *Ayer comí paella*)。学习规则和主要不规则动词的变位。
        -   **过去未完成时 (Pretérito Imperfecto)**: 用于描述过去的背景、状态、习惯或正在进行的动作 (e.g., *Cuando era niño, jugaba al fútbol*)。
    2.  **过去时的对比**: 学习在同一个故事中，如何结合使用“简单过去时”和“过去未完成时”来清晰地叙事。这是A2阶段的重中之重。
    3.  **现在完成时 (Pretérito Perfecto)**: 学习用来描述与当前有关的、或在“今天/本周”等时间范围内发生的过去动作 (e.g., *Hoy he trabajado mucho*)。
    4.  **代词进阶**: 学习**间接宾语代词** (`me`, `te`, `le`...)，并掌握双宾语代词同时使用的顺序和规则。
- **核心词汇 (Vocabulario Clave):**
    -   **时间标记**: 昨天、去年、...的时候、当时。
    -   **个人经历**: 旅行、教育经历、工作经历、一个特别的日子。
    -   **传记词汇**: 出生、成长、学习、工作、搬家。
    -   **连接词**: `cuando`, `mientras`, `entonces`, `de repente`。

#### **第四课: 未来的计划与假设 (Planes y posibilidades)**
- **目标**: 进入B1水平。学生将能流利地讨论未来、提出建议、表达愿望和意见，并进行简单的假设。
- **核心语法 (Gramática Clave):**
    1.  **将来时态**:
        -   **将来未完成时 (Futuro Simple)**: 学习表达对未来的预测或计划 (e.g., *Mañana lloverá*, *El año que viene viajaré a España*)。
        -   **虚拟式将来时 (Presente de Subjuntivo)**: 这是B1的标志性语法。用于表达愿望、建议、怀疑、不确定性等主观情绪 (e.g., *Quiero que vengas*, *Es posible que llueva*)。
    2.  **条件式 (Condicional Simple)**: 用于提出礼貌的请求、给予建议或谈论假设 (e.g., *Me gustaría un café*, *Yo en tu lugar, estudiaría más*)。
    3.  **命令式 (Imperativo)**: 学习如何给出肯定的指令和建议。
    4.  **Por vs. Para**: 系统学习这两个核心介词的区别和用法。
    5.  **比较级与最高级**: `más...que`, `menos...que`, `el/la más...`。
- **核心词汇 (Vocabulario Clave):**
    -   **未来计划**: 职业规划、学习目标、旅行计划。
    -   **观点与情感**: 我认为、我相信、我希望、我建议、我怀疑。
    -   **健康与生活方式**: 饮食、运动、健康建议。
    -   **工作与面试**: 技能、经验、求职、面试常用语。

---

## 开发日志 (Changelog)

### 2025-12-12: Lesson 4 视觉增强与比例标准化 (by Gemini)
- **目标**: 为第四课增加高质量的视觉辅助，并统一全站图片比例标准以提升视觉体验。
- **主要成果**:
    1.  **Lesson 4 配图生成**:
        -   针对课文核心内容（欢迎页/未来规划、产出任务/工作台、情景对话/职场沟通），使用 AI 生成了三张高精度插图.
        -   图片风格统一为“现代简约/职场专业”，贴合课程定位.
    2.  **图片比例标准化 (21:9)**:
        -   全站推行 **21:9 (Ultrawide)** 宽画幅图片标准，增强沉浸感并适配现代屏幕布局.
        -   在 `src/css/style.css` 中确认了 `.aspect-ratio-21-9` 类，并将其应用于所有新生成的图片.
    3.  **代码实现**:
        -   更新 `lesson-04.html`，植入新图片并应用标准化 CSS 类.

### 2025-12-08: 课程内容深化与DELE B1实战模块新增 (by Gemini)
- **目标**: 针对DELE B1考点，深化核心语法教学，并提供全真模拟练习。
- **主要成果**:
    1.  **Lesson 3 内容强化**: 新增“语法核心 (Plus): 过去完成时 (Pretérito Pluscuamperfecto)”模块，填补叙事时间轴空白。
    2.  **Lesson 4 内容强化**:
        -   扩展“命令式”模块，完整覆盖肯定与否定命令式（包括不规则动词变位）。
        -   新增“逻辑与后果：第一类条件句 (Si + Presente, Futuro)”模块，增强假设表达能力。
    3.  **DELE B1 模拟实战模块**:
        -   创建独立页面 `src/mock-exam.html`，提供 DELE B1 阅读理解和语言运用模拟题。
        -   题目与选项全部西班牙语化，严格对标考试形式。
        -   优化页面布局，确保“返回目录”按钮居中。
        -   集成判分逻辑，并更新 `src/js/course-data.js` 添加答案和解析。
    4.  **发音支持完善**: 为 Lesson 3 和 Lesson 4 中新增/修改的语法点、变位和例句补充了慢速发音按钮，保持全站一致性。

---


### 2025-11-07: 复习课内容深化与体验优化 (by Gemini)
- **目标课程**: `lesson-review-01-02.html`
- **样式修复**: 修正了“现在时巩固”部分表格的CSS类，应用了正确的项目内表格样式。
- **内容深化与重构**:
    - 为 `ser`, `estar`, `ir`, `tener` 四个核心不规则动词补充了完整的六人称变位表。
    - 优化了 `Ser vs. Estar` 的讲解，补充了“人际关系”用法和进行时例句。
    - 为 `Gustar` 和反身动词增加了语法提示和完整的代词列表，深化了对逻辑的理解。
    - 重构了不规则动词展示区，将例句与变位表整合，使结构更清晰。
- **体验优化**:
    - 全面审计并补全了所有新增及遗漏的动词变位、例句的发音按钮（标准及慢速）。
    - 修正了上一版更新中意外引入的 Markdown 语法错误 (`**` -> `<strong>`)。

---

### 2025-11-06: 内容深化与导航优化 (by codex)
- 复习拆分与导航重构
  - 将原“第一阶段复习与巩固”（`src/lesson-review-01.html`，覆盖 1–4）的总复习内容，按阶段拆分为两页：
    - `src/lesson-review-01-02.html`（第一阶段复习 1–2）：发音最小对立、现在时巩固（规则/不规则）、Ser vs Estar 诊所、gustar/反身/hay、口语产出、小测与跳转。
    - `src/lesson-review-03-04.html`（第二阶段复习 3–4）：过去时对比（Indefinido/Imperfecto/Perfecto）、Futuro/Condicional、Subjuntivo 触发、Por/Para、比较级、应用产出与小测。
  - 首页导航（`src/index.html`）：在“阶段复习”板块中，保留旧版 `lesson-review-01.html` 作为归档，移至列表最下方并用删除线标记；为各链接加入 emoji 提升辨识度；维持“主线/复习/工具”三段式结构与配色区隔。

- Lesson 4 深化与一致性（`src/lesson-04.html`）
  - 变位表发音：为 Futuro/Condicional/Subjuntivo/Imperativo 全部变位表逐词补齐发音按钮（正常/慢速），并保留“整表朗读”入口，交互与前几课保持一致。
  - 规则提示：在 Subjuntivo（WEIRDO）、Condicional、Por/Para 段落加入“规则/对比/反例/边界”提示卡（tip-box），帮助快速建立可迁移的判断线索；修复 WEIRDO 表格若干示例缺少慢速发音的问题。
  - 样式支持：新增 `.tip-box`（紫色信息框）到 `src/css/style.css`，统一信息框视觉体系，与 `.practice-box/.english-comparison` 风格一致。

- 测验质量与答案解释
  - 复习A（1–2）答案分布重平衡：重排题目 q3、q4、q6、q7、q10、q11、q12、q13、q15、q18、q20、q21、q22 的选项顺序，使正确项在 a/b/c 位置更均衡；同步更新 `src/js/course-data.js` 答案键，保持题干与中文解释不变。
  - 说明：如需进一步“运行时随机化”选项，后续可在渲染层加入轻量逻辑并映射正确项。

- 工具与练习的一致性（延续既有工作）
  - 练习中心（`src/practice.html`）与工具包（`src/toolkit.html`）维持统一风格与底部返回目录布局；Por/Para 与 Subjuntivo 触发 DnD 练习按统一交互反馈。
  - 常用表达（`src/expressions.html`）继续保留收藏与搜索（localStorage）以及慢速发音覆盖与可访问性。

- 既知限制
  - TTS 接口 `/api/speak` 在本地开发返回 404（接受现状，未在本轮修复）；E2E 用例保留在 `e2e/` 目录，本地验证使用，未接入 CI。


### 2025-11-06 (续): 课程结构优化与内容深化 (by Gemini)
- **目标**: 根据教学反馈，优化课程结构，深化核心概念讲解，并增加专门的复习环节以巩固学习效果。
- **主要成果**:
    1.  **新增第一阶段复习课**:
        - 创建了 `src/lesson-review-01.html`，作为一节独立的复习课，专注于解决学生在发音、核心时态（Ser/Estar, 过去时）和 `por/para` 等方面的薄弱环节。
        - 设计了包括“最小对立练习”、“语法诊所”和“看图说话”在内的多种综合练习形式。
        - 将复习课无缝集成到主页 `index.html` 和课程导航 `js/course-data.js` 中。
    2.  **第四课内容深化与重构**:
        - **补充变位示例**: 为将来时、条件式和虚拟式的规则动词，用完整的变位对照表替换了原有的抽象词尾列表，提供了具体动词（`hablar`, `comer`, `vivir`）的变位示例。
        - **强化不规则动词讲解**: 为将来时和条件式补充了不规则动词的完整变位表示例（`tener`, `poder`），并明确指出两者共享不规则词干。
        - **优化命令式教学**: 使用表格清晰展示了 `tú` 和 `usted` 在规则与不规则动词下的肯定命令式变位，并补充了其构成逻辑的说明。
        - **补充中文翻译**: 为 `futuro simple` (简单将来时), `condicional simple` (简单条件式), `subjuntivo` (虚拟式), `imperativo` (命令式) 等所有核心语法术语，在首次出现时都添加了明确的中文翻译。
    3.  **课程结构与体验优化**:
        - **合并介绍章节**: 将第四课的“欢迎目标”和“学习路线”两个开篇幻灯片合并为一个，使课程介绍更紧凑连贯。
        - **修正章节编号**: 在合并幻- 修复与微调：将 Subjuntivo 分拣移至对应章节；Por/Para 分拣中 “por la tarde” 分类错误已更正。
- 练习与工具
  - 新增 `src/practice.html`（练习中心）：影子跟读（可调停顿/慢速）、关键表达填空、时态选择（现在/简单过去/未完成）判分、邮件写作生成器（本地存储草稿）。
  - 新增 `src/toolkit.html`（职场沟通工具包）：邮件模板→收尾语→会议表达→会议纪要→建议与礼貌请求→STAR→Por/Para 速查→面试自我介绍；全部示例补全慢速发音。
- 常用表达库
  - 扩充 `src/js/course-data.js`：新增 Meetings、Email Sign-offs、Politeness & Softeners、Spainisms；表达页新增搜索与收藏（localStorage 持久化）。
- 交互与可访问性
  - 统一 speak 图标可访问性：添加 `aria-label`/`role`/`tabindex`，支持 Enter/Space 触发；在 expressions 与 lesson 页面动态/静态节点均生效。
  - 新增拖拽分拣练习（Por vs. Para、Subjuntivo 触发）：HTML5 DnD，无外部依赖，正确/错误高亮反馈。
- UI/UX
  - 首页分区：将主线课程与功能工具分区展示（颜色区隔），提升信息结构与可扫读性。
  - 练习中心与工具包底部“返回目录”居中对齐；练习中心工具栏/按钮/输入使用统一风格（`.tool-row`/`.btn-outline-primary`/`.form-control`）。
  - lesson-04 小测提示改为“即时反馈”。
- 其他
  - 初步建立 E2E 用例与配置（Playwright），用于本地端到端验证；当前不纳入 CI 与日常流程。


### 2025-11-05: 工程化与规范化改进 (Tooling & Code Quality)
- 目标：稳定编码显示、统一代码规范、在不影响部署的前提下引入持续检查。
- 已完成：
  - 终端编码：明确 PowerShell 使用 UTF‑8（65001），问题来自终端显示而非文件内容。
  - 代码风格：新增 `./.prettierrc`（endOfLine: auto，4 空格、分号、单引号）。
  - 编辑器约定：新增 `./.editorconfig`（utf-8、CRLF、4 空格、末行换行、去尾随空格，Markdown 除外）。
  - Lint 配置：更新 `./eslint.config.js`，为 Prettier 增加 `endOfLine: 'auto'`；对 `api/**/*.js` 增加 CommonJS 覆盖。
  - 依赖声明：在 `package.json` 的 `devDependencies` 补充 `@eslint/js`、`globals`，保证新环境/CI 可复现。
  - Git 行尾：新增 `./.gitattributes`（默认 CRLF；`*.sh`/`*.bash` 强制 LF）。
  - 代码整理：使用 Prettier 格式化 `src/js/course-data.js` 与 `src/js/main.js`；当前 `eslint .` 为 0 错 0 警告。
  - CI 检查：新增 `./.github/workflows/lint.yml`，在 push/PR 到 `main` 时运行 ESLint，`continue-on-error: true`（不阻断部署）。
  - Shell 约定：调用 `pwsh` 时不带 `-NoProfile`，默认 UTF‑8；必要时可在单条命令内内联设置编码（`[Console]::OutputEncoding = [Text.Encoding]::UTF8; chcp 65001 | Out-Null`）。
- 说明与建议：
  - `node_modules` 目前仍在仓库中；不影响 SWA 部署，但拉取体积大且依赖不可复现，建议后续清理：
    - `git rm -r --cached node_modules && git commit -m "Remove node_modules from repo"`
    - 依赖通过 `npm ci`/`npm install` 安装。`.gitignore` 已包含 `/node_modules`。

### **2025-11-04: 布局修复与配色方案选择 (Layout Fixes & Color Palette Selection)**
- **目标**: 修复网站内容重叠和垂直居中布局问题，并根据用户反馈选择新的柔和配色方案。
- **成果**:
    - **布局修复**: 解决了内容与导航栏重叠的问题，并实现了页面内容的垂直居中。
    - **配色方案选择**: 经过在线搜索和用户确认，选择了“现代自然”配色方案。
- **未完成**: 正在逐一应用“现代自然”配色方案中的颜色和阴影调整。

---

### **2025-10-31: “常用表达”模块开发与全站UI优化 (Common Expressions Module & Site-wide UI Enhancements)**
- **目标**: 新增一个独立的西班牙语常用表达查询板块，并根据用户反馈对全站UI/UX进行多轮迭代优化。
- **成果**:
    - **新功能：“常用表达”模块**:
        - 创建了 `src/expressions.html` 页面，并从主页 `index.html` 添加了导航入口。
        - 采用“数据与视图分离”的最佳实践，将所有表达（含西、英、中三语）及分类存放在 `src/js/course-data.js` 中，由 `src/js/main.js` 动态渲染到页面，便于未来维护。
        - 为新页面设计了美观的卡片式布局，并集成了标准/慢速双语音频播放功能。
    - **UI/UX 优化**:
        - **修复导航Bug**: 解决了因代码修改导致课程页面“上一课/下一课”按钮消失的回归问题。
        - **优化按钮样式与布局**: 将课程页面底部的文本导航链接，改造为具有清晰视觉反馈的“按钮”样式。同时，采用CSS Grid布局，固定了“上一课/返回/下一课”按钮的左、中、右位置，避免了因按钮显隐造成的布局位移。
        - **细节打磨**: 根据用户反馈，调整了“常用表达”页面的发音按钮位置和间距，并将中文翻译统一为左对齐，提升了可读性。

---

### **2025-10-28 (续): 第三课不规则动词模块迭代优化 (Lesson 3 Irregular Verbs Module Iteration)**
- **目标**: 根据用户反馈，优化第三课中简单过去时不规则动词的展示方式，使其更符合学习习惯且信息完整。
- **成果**:
    - **内容扩充**: 确认了课程初版中不规则动词列表（Ser, Ir, Dar, Ver）不完整后，增加了对U-词根、I-词根、J-词根等核心不规则动词的讲解。
    - **格式迭代**:
        1.  **初版尝试**: 以精简的列表形式补充了`tener`, `hacer`, `decir`等动词的变位。
        2.  **二次迭代**: 根据用户偏好，将所有新增动词整合进一个更详细的表格，包含词根、第一人称变位和例句。
        3.  **三次迭代 (最终版)**: 再次根据用户反馈进行调整，恢复为“一个动词一列，一个人称一行”的传统动词变位表格式。将U/I/J词根的动词分别组织在三个独立的表格中，方便横向对比。
    - **信息完善**: 最终版本的表头采纳了用户的全部建议，将动词的中文含义、不规则词根（如 `tuv-`）都清晰地标注出来，实现了信息密度与排版的最佳平衡。
- **状态**: `lesson-03.html` 中的不规则动词模块已达到一个内容完整、格式清晰的最终状态。

---

### **2025-10-28: 第三课内容增强与UX优化 (Lesson 3 Enhancement & UX Optimization)**
- **目标**: 丰富第三课的文化内涵和视觉元素，并修复课程间的导航问题。
- **成果**:
    - **视觉与内容增强**:
        - 为第三课的欢迎页和对话部分集成了新的主题图片 (`welcome-upscaled.png`, `Conversation.png`)。
        - 新增了“文化角：西班牙的节庆与传统”模块，通过搜索核实并添加了节日的具体日期和更详尽的背景介绍。
        - 优化了“文化角”的排版，调整了模块位置，并修正了图片引用路径中的文件名错误 (`spanish_festival.png` -> `spanish-festival.png`)。
    - **用户体验 (UX) 优化**:
        - 修复了在课程间（如从第三课到第二课）切换时，页面会自动跳转到旧页码的导航Bug。
        - 通过修改 `src/js/main.js`，为课程切换链接添加了清除 `sessionStorage` 的逻辑，确保用户每次进入新课程时都从第一页开始，提升了学习流程的清晰度和体验。

---



### **2025-10-27: 第三课内容创建与集成 (Lesson 3 Content Creation & Integration)**
- **目标**: 基于课程体系规划，从零开始创建第三课内容，并将其集成到课程网站中。
- **成果**：
    - **课程文件创建**: 创建了 `src/lesson-03.html` 文件，作为第三课的独立页面。
    - **内容框架搭建**: 按照课程大纲，填充了第三课的初始内容，包括欢迎页、语法核心（简单过去时、过去未完成时、现在完成时及其对比）、词汇模块、闪卡练习、随堂测验、综合情景对话以及总结与课后任务。
    - **课程数据更新**: 更新了 `src/js/course-data.js`，将 `lesson-03.html` 添加到课程计划中，并初始化了测验答案。
    - **主页导航集成**: 更新了 `src/index.html`，添加了指向 `lesson-03.html` 的导航链接，确保新课程可从主页访问。

---

### **2025-10-27: 第三课内容与排版优化 (Lesson 3 Content & Layout Optimization)**
- **目标**: 进一步优化第三课内容，提升用户体验和可读性。
- **成果**：
    - **内容精修**: 
        - 修复了HTML中残留的Markdown粗体语法，统一为 `<strong>` 标签。
        - 为所有动词原形和重点西班牙语内容（包括 `<code>` 标签内的词汇和 `<b>` 标签内的动词）补全了发音按钮。
        - 为 `Indefinido` 和 `Imperfecto` 等关键语法术语增加了中文翻译，并将其整合到描述性文本中。
        - 简化了语法模块的 `<h2>` 标题，移除了其中的西班牙语部分，使其更简洁明了。
    - **互动练习扩充**: 
        - 将第三课的闪卡数量从9个增加到15个，涵盖了更多核心词汇。
        - 将随堂测验题目从5道增加到10道，更全面地考察了本课的语法知识。
    - **情景对话优化**: 
        - 增加了情景对话的中文翻译对照，方便学生理解。
        - 优化了情景对话的HTML结构，引入了 `.dialogue-turn`, `.speaker`, `.spanish-line`, `.chinese-translation` 等新类，为后续的CSS样式调整打下基础。
        - 添加了新的CSS样式规则到 `src/css/style.css`，以改善情景对话的排版和视觉效果（包括间距、边框、背景色和字体样式）。
    - **图片资源管理**: 
        - 将第二课的所有图片（`colleagues_conversing.png`, `spanish_lunch.jpg`, `welcome.png`, `welcome-alt.png`）从 `src/images` 移动到 `src/images/lesson-02` 子目录。
        - 更新了 `lesson-02.html` 中所有相关图片的路径，实现了更清晰的资源管理和项目维护。

---

### **2025-10-20 (续): ESLint 配置优化 (ESLint Config Optimization)**
- **目标**: 将 ESLint 配置文件 (`eslint.config.js`) 重构为更简洁、更符合 ESLint v9+ 官方推荐的扁平化配置风格。
- **成果**:
    - 采用了将 `prettierConfig` 作为顶层配置项放置在数组末尾的方式，来禁用与 Prettier 冲突的规则，取代了之前在 `rules` 中手动展开的冗余操作。
    - 新的配置在功能上完全等价，但结构更清晰，可读性与可维护性更高。
    - 通过 `npm run lint:fix` 验证了新配置的有效性并格式化了整个项目。

---

### **2025-10-20: 代码审查与现代化改造 (Code Review & Modernization)**

**核心目标：** 对“西班牙语入门”课程项目进行全面的代码审查、修复关键问题并进行现代化改造，以提升其安全性、稳定性与可维护性。

**主要成果：**
1.  **安全加固**：成功修复了后端语音API中的SSML注入漏洞，杜绝了潜在的安全风险。
2.  **代码质量标准化**：引入了 'ESLint' 和 'Prettier' 工具，建立了代码规范并对整个项目进行了格式化，为未来的开发和维护奠定了坚实的基础。
3.  **技术栈现代化**：将整个前端JavaScript代码库从传统脚本升级为现代ES Modules ('import'/'export')，提升了代码的模块化和组织性。
4.  **关键Bug修复**：解决了在本地开发服务器环境下，因URL路径问题导致的测验功能无法正常计分的问题。
5.  **开发环境优化**：为项目配置了标准的 'npm start' 启动命令，简化了本地开发流程。

**详细历程回顾：**

我们的合作始于一个开放性的代码审查请求。在初步分析中，我们发现了包括后端安全漏洞、前端代码健壮性不足以及缺少代码规范在内的多个待办事项。

1.  **安全先行**：我们首先解决了最紧急的**SSML注入漏洞**，通过对API的输入进行转义，确保了语音合成功能的安全性。
2.  **引入规范**：接着，我们为项目**集成了ESLint和Prettier**。在这个过程中，我们遇到了ESLint v9版本不再支持旧版 '.eslintrc.json' 配置的问题，通过创建新的 'eslint.config.js' 文件，我们成功解决了这个问题，并为项目配置了统一的代码风格。
3.  **走向现代**：为了提升代码质量，我们进行了**ES模块化改造**。这一步虽然让代码结构更清晰，但也引入了新的挑战：浏览器出于安全策略（CORS），禁止了在 `file://` 协议下加载模块。
4.  **攻克本地环境**：
    *   为了解决CORS问题，我们引入了 `serve` 工具来搭建本地服务器，并配置了 `npm start` 命令。
    *   然而，新的环境暴露了两个新问题：**测验逻辑因URL后缀不匹配而失效**，以及**发音功能因 `serve` 无法运行后端API而失灵**。
    *   我们曾尝试使用功能更强大的官方工具 `SWA CLI` 来同时解决这两个问题，但这又触发了您本地Node.js版本过高（v24）与该工具不兼容的深层环境问题。
    *   在讨论了使用Node版本管理器（NVM）的复杂性后，您果断决定，**优先保障线上功能和核心开发体验**。
5.  **回退与聚焦**：我们采纳了您的决定，回退到使用 `serve` 的简单环境。我卸载了 `SWA CLI`，并将 `start` 命令恢复。然后，我们集中精力**修复了测验逻辑的Bug**，使其能够智能处理URL，保证了核心学习功能的正常。
6.  **部署与验证**：最后，我们将所有修复和改进整合到一个Git提交中，并成功推送到GitHub。您通过线上环境的测试，最终确认**语音功能已恢复正常**，证明了我们最初的后端修复是成功的，而本地发音问题确实是开发环境所致。

**当前项目状态：**
*   **线上环境**：功能完整，运行正常。所有安全、逻辑和代码质量的改进均已生效。
*   **本地环境**：使用 `npm start` 启动。除需要后端API的发音功能外，其余功能（包括课程浏览、交互、测验）均可正常使用和开发。这是一个为简化本地环境而接受的已知限制。
*   **代码仓库**：所有修改已合并到 `main` 分支，项目处于一个稳定、健壮且更具可维护性的新阶段。

---

**2025-10-18 (续):**
- **功能修复与代码重构 (Fix & Refactor)**:
    - **修复测验功能**: 重构了测验逻辑，将课程答案从 `main.js` 中分离至 `course-data.js`，彻底解决了第二课测验无法正确计分的问题。
    - **优化课程导航**: 将课程列表数据移入 `course-data.js`，为后续自动化更新导航链接打下基础。
    - **CSS代码规范**: 将 `lesson-02.html` 中的图片行内样式重构为可复用的CSS类，并移入 `style.css` 文件，实现了内容与样式的分离。
    - **格式修复**: 修正了“Ser vs. Estar”一节中误用的Markdown粗体语法。

**2025-10-18 (续):**
- **第二课内容优化 (Lesson 2 Content Optimization)**:
    - **动词变位讲解优化**: 统一了 `-ar`, `-er`, `-ir` 规则动词的讲解结构，为 `-er` 和 `-ir` 动词增加了完整的变位表格及例句，使学习路径更清晰。
    - **语法逻辑顺序调整**: 调整了语法核心部分的讲解顺序，将“反身动词”后移，使语法概念的递进更有逻辑性。
    - **UI清理**: 移除了“随堂测验”中已无实际功能的“提交答案”按钮，简化了界面。

**2025-10-18 (续):**
- **第二课优化：图片集成**：
    - 在“综合情景对话”模块中添加了 `colleagues_conversing.png` 图片，并设置了21:9比例。
    - 在“欢迎来到第二课”模块中添加了 `welcome.png` 图片，并移除了比例限制。

**2025-10-18 (续):**
- **第二课优化：图片集成**：
    - 在“文化角”模块中添加了 `spanish_lunch.jpg` 图片。
    - 调整图片位置至标题下方、内容上方，并增加了圆角和响应式样式。
    - 讨论并决定图片比例暂时保持不变。

**2025-10-18:**
- **第二课开发 (Mi día a día)**：
    - **课程框架搭建**：创建 `lesson-02.html` 并链接到主页 `index.html`。
    - **内容填充**：
        - 欢迎与目标介绍。
        - 语法核心：现在时规则动词变位 (`-ar`, `-er`, `-ir`)。
        - 语法核心：反身动词与日常作息，并增加了“反身动词 vs. 非反身动词”对比环节。
        - 语法核心：关键不规则动词 (`Tener`, `Ir`)。
        - 语法核心：`Ser` vs. `Estar` 的深入讲解。
        - 语法核心：`Gustar` 的特殊用法。
        - 语法核心：情态动词 (`poder`, `querer`, `tener que`)。
        - 词汇模块：日常活动、地点交通、食物饮料。
        - 互动练习：闪卡练习（已扩充词汇量）。
        - 随堂测验。
        - 综合情景对话 (Diálogo Integrado)。
        - 文化角 (Rincón Cultural)：西班牙人的作息时间（已扩充趣味知识）。
        - 总结与课后任务。
    - **结构修复**：修复了 `lesson-02.html` 因误操作导致的HTML结构缺失问题，确保页面样式和交互功能正常。

**2025-10-17:**
- **功能实现：慢速播放**：为所有发音功能增加了慢速播放选项，并最终选定“时钟-减号”作为慢速播放图标。
- **UI/UX 优化**：
    - 在移动端彻底隐藏了计时器工具。
    - 优化了移动端导航栏，通过隐藏页码显示解决了长标题的拥挤问题。
    - 简化了所有“词汇扩充”章节的标题为“词汇”。
- **功能尝试与回退：页面过渡动画**：
    - 尝试为页面切换实现“交叉淡入淡出”效果，并适配不同高度的页面。
    - 由于在高度动态计算上遇到难以解决的顽固bug，为保证项目稳定性，决定放弃此功能。
    - **代码已通过 `git revert` 操作，将线上与本地代码全部回退至无此动画功能的稳定版本。**


**2025-10-13:**
- **UI/UX 体验优化**:
    - 实现顶部固定导航栏，方便在长页面中随时翻页。
    - 重构页面布局为顶部对齐，解决了内容与导航栏的重叠问题及`index`页的空旷感，统一了全站体验。
    - 为移动端设计了可折叠的计时器，默认收起以节省屏幕空间，点击时间可展开。
    - 将翻页按钮的文字替换为 `«` 和 `»` 符号，使界面更简洁。

**2025-10-11:**
- **内容与功能精修**：
    - 恢复了 `lesson-01.html` 的所有原始内容细节，并确保了所有功能（分页、发音、闪卡、测验、计时器等）的完整集成。
    - 修正了“你的职业身份”等页面的内容遗漏。
    - 扩充了“基础生活”、“职业关联”、“高频形容词”等词汇表。
    - 增加了闪卡数量，扩充了测验题目至12题，并修正了题干。
    - 优化了计时器逻辑，调整了颜色阈值（0-60绿，60-100橙，100+红）。
    - 修复了闪卡翻转尺寸和英中分行显示问题。
    - 优化了分页按钮和下拉菜单的样式。
    - 最终版本已部署至GitHub Pages。

**2025-10-11:**
- **确立新方向：课程体系重构**。我们决定将现有的单节课内容，根据成熟的语言教学框架（如CEFR A1标准），拆分为一个循序渐进的、更易于学习的迷你课程系列。

---

## 待办优化列表 (Optimization Backlog)

### 方案：语音体验升级 (专业TTS服务集成)
- **目标**: 将课程网站的发音功能，从不稳定的浏览器内置语音升级为由Azure提供的、高质量、发音统一的专业神经网络语音服务。
- **最终架构**: 采用前后端分离方案。前端静态文件托管于**Azure静态Web应用**的全球CDN。后端API函数同样由静态Web应用承载，通过直接调用**语音服务REST API**的方式提供服务，以确保最佳的兼容性和稳定性。
- **成本**: 利用Azure的永久免费套餐，本项目成本为零。
- **状态**: ✅ **已完成 (Completed)**。
- **历程总结**:
    - 最初计划使用`microsoft-cognitiveservices-speech-sdk`，但在部署过程中遇到了复杂的兼容性问题。
    - **调试过程**: 经历了多次部署失败，从“找不到构建脚本”到“找不到应用产物”，再到API的`404 (Not Found)`和`500 (Internal Server Error)`错误。
    - **问题根源**: 经过反复排查和验证，最终确认核心障碍是`speech-sdk`包的原生依赖与Azure静态Web应用精简的函数运行环境不兼容，导致函数在加载时直接崩溃。
    - **最终方案**: 放弃SDK，改为通过Node.js内置的`https`模块直接调用Azure语音服务的**REST API**，彻底绕开了环境兼容性问题，最终成功实现功能。
    - **核心教训**: 在轻量级Serverless环境中，应优先选择无依赖的REST API方案，而不是可能存在兼容性问题的复杂SDK。

### UI/UX 体验优化 (UI/UX Enhancements)
- [ ] **手势滑动翻页 (Swipe Gesture Navigation)**: 在移动端增加左右滑动切换上一页/下一页的功能。

### 代码模板化 (Code Templating)
- [ ] **目标**: 消除各课程页面之间大量重复的HTML代码，实现“一次修改，处处生效”的终极目标。
- [ ] **方案 (细化)**:
    1.  **设计统一数据结构**: 在 `course-data.js` 中为课程内容设计一个通用的、基于“模块”的JSON结构。每个模块都将有明确的类型，如 `{ "type": "paragraph", "content": "..." }`, `{ "type": "vocab_table", "data": [...] }`, `{ "type": "quiz", "questions": [...] }` 等。
    2.  **构建课程渲染引擎**: 在 `main.js` 中创建一个强大的渲染函数。该函数负责读取指定课程的数据，遍历其“模块”列表，并根据每个模块的类型，调用相应的子函数来动态生成HTML。
    3.  **内容迁移**: 手动将 `lesson-01.html` 等现有课程页面的内容，逐一“翻译”并迁移到 `course-data.js` 的新数据结构中。
    4.  **统一页面模板**: 最终，所有课程都可以使用一个通用的 `lesson.html` 模板页面，该页面只包含一个用于承载动态内容的“空壳”容器。
- [ ] **收益 (补充)**:
    - **高效维护**: 修改或新增内容只需操作数据文件，无需触碰HTML，极大降低维护成本。
    - **风格统一**: 所有课程由同一引擎渲染，确保了视觉和交互的绝对一致性。
    - **快速开发**: 未来创建新课程（如第四课）时，只需专注编写内容数据，开发效率将得到质的飞跃。
- [ ] **风险与避坑 (补充)**:
    - **渲染引擎的复杂性**: 随着模块类型增多，渲染引擎的逻辑会变得复杂，需要精心设计。
    - **内容迁移的繁琐性**: 将现有HTML内容手动迁移到JS数据结构中，过程繁琐且易出错，需要细致的核对工作。
    - **脚本执行顺序 (Race Condition)**: 负责创建HTML模板的脚本和负责为模板绑定交互功能（如测验、发音）的脚本，两者执行顺序必须严格保证。必须确保**模板渲染完毕后，再执行功能绑定**，以避免后者因找不到目标元素而报错。


### 1. 丰富互动练习 (Richer Interactive Exercises)
- [x] **发音辅助 (Audio Clips)** - 已完成
- [x] **单词闪卡 (Flashcards)** - 已完成
- [x] **小测验 (Quiz)** - 已完成

### 2. 构建实用语法 (Practical Grammar Building Blocks)
- [ ] **引入核心动词 `Estar`**: 讲解与 `Ser` 的区别。
- [ ] **引入核心动词 `Tener`**: 讲解“拥有”的概念。
- [ ] **引入规则动词**: 讲解 `-ar` 结尾动词的基础变位。

### 3. 融入文化与情境 (Integrating Culture and Context)
- [ ] **文化小贴士**: 介绍西班牙职场文化。
- [ ] **情景对话**: 模拟真实场景。
- [ ] **称谓的艺术**: 讲解 `Tú` (非正式你) vs. `Usted` (正式您) 的用法。

### 4. 深度结合专业领域 (Connecting with the Professional Field)
- [ ] **专业动词**: `conectar`, `instalar`, `reparar`。
- [ ] **真实材料解读**: 选取一段来自 `Iberdrola` 等公司官网的真实句子进行精讲。
