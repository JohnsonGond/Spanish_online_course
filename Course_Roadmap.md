# 西班牙语课程优化路线图 (Spanish Course Optimization Roadmap)

---

## 课程体系规划 (A1-B1)

### **总体思路:**
我们的目标是用4节大课，引导学生从0基础（A1）入门，逐步过渡到能够进行独立沟通（B1）的水平。每节课都将围绕一个核心主题展开，并在主题下融合语法、词汇和实际应用。

- **第一课 (已完成):** `你好，世界！` (A1入门) - 核心是身份认同和进行最基础的自我介绍。
- **第二课 (规划中):** `我的日常生活` (完成A1, 迈向A2) - 核心是描述常规活动、喜好和身边环境。
- **第三课 (规划中):** `过去的故事` (A2核心) - 核心是学习叙述过去发生的事情，这是语言能力的一大飞跃。
- **第四课 (规划中):** `未来的计划与假设` (B1入门) - 核心是表达观点、计划、建议和想象中的情景。

---

### **课程规划详情**

#### **第二课: 我的日常生活 (Mi día a día)**
- **目标**: 完成A1阶段，开始进入A2。学生将能详细描述个人生活、日程、喜好和周围环境。
- **核心语法 (Gramática Clave):**
    1.  **动词强化**:
        -   系统学习**现在时**规则动词变位 (`-ar`, `-er`, `-ir`)。
        -   引入核心不规则动词 **Estar** (状态、位置), **Tener** (拥有), **Ir** (去)。
        -   深入学习 **Ser vs. Estar** 的区别。
    2.  **重要句型**:
        -   `Gustar` (及类似动词) 的用法，表达喜好 (e.g., *Me gusta el café*)。
        -   `Hay` 的用法 (e.g., *En mi oficina hay tres mesas*)。
        -   情态动词 `poder` (能够), `querer` (想要), `tener que` (必须)。
    3.  **代词入门**: 引入**直接宾语代词** (`lo`, `la`, `los`, `las`)，使表达更地道 (e.g., *¿Lees el libro? -> Sí, lo leo.*)。
    4.  **反身动词**: 学习日常作息相关的动词 (e.g., `levantarse`, `ducharse`)。
- **核心词汇 (Vocabulario Clave):**
    -   **日常生活**: 工作日、周末、日程安排、时间点。
    -   **地点与交通**: 办公室、家、城市、交通工具。
    -   **食物与饮料**: 一日三餐、餐厅点餐常用语。
    -   **爱好与活动**: 运动、音乐、电影、阅读。

#### **第三课: 过去的故事 (Historias del pasado)**
- **目标**: 掌握A2核心能力。学生将能叙述和讨论过去发生的具体事件、经历和背景故事。
- **核心语法 (Gramática Clave):**
    1.  **两大过去时态**:
        -   **简单过去时 (Pretérito Indefinido)**: 用于叙述已经完成的、具体的过去动作 (e.g., *Ayer comí paella*)。学习规则和主要不规则动词的变位。
        -   **过去未完成时 (Pretérito Imperfecto)**: 用于描述过去的背景、状态、习惯或正在进行的动作 (e.g., *Cuando era niño, jugaba al fútbol*)。
    2.  **过去时的对比**: 学习在同一个故事中，如何结合使用“简单过去时”和“过去未完成时”来清晰地叙事。这是A2阶段的重中之重。
    3.  **现在完成时 (Pretérito Perfecto)**: 学习用来描述与当前有关的、或在“今天/本周”等时间范围内发生的过去动作 (e.g., *Hoy he trabajado mucho*)。
    4.  **代词进阶**: 学习**间接宾语代词** (`me`, `te`, `le`...)，并掌握双宾语代词同时使用的顺序和规则。
- **核心词汇 (Vocabulario Clave):**
    -   **时间标记**: 昨天、去年、...的时候、当时。
    -   **个人经历**: 旅行、教育经历、工作经历、一个特别的日子。
    -   **传记词汇**: 出生、成长、学习、工作、搬家。
    -   **连接词**: `cuando`, `mientras`, `entonces`, `de repente`。

#### **第四课: 未来的计划与假设 (Planes y posibilidades)**
- **目标**: 进入B1水平。学生将能流利地讨论未来、提出建议、表达愿望和意见，并进行简单的假设。
- **核心语法 (Gramática Clave):**
    1.  **将来时态**:
        -   **将来未完成时 (Futuro Simple)**: 学习表达对未来的预测或计划 (e.g., *Mañana lloverá*, *El año que viene viajaré a España*)。
        -   **虚拟式将来时 (Presente de Subjuntivo)**: 这是B1的标志性语法。用于表达愿望、建议、怀疑、不确定性等主观情绪 (e.g., *Quiero que vengas*, *Es posible que llueva*)。
    2.  **条件式 (Condicional Simple)**: 用于提出礼貌的请求、给予建议或谈论假设 (e.g., *Me gustaría un café*, *Yo en tu lugar, estudiaría más*)。
    3.  **命令式 (Imperativo)**: 学习如何给出肯定的指令和建议。
    4.  **Por vs. Para**: 系统学习这两个核心介词的区别和用法。
    5.  **比较级与最高级**: `más...que`, `menos...que`, `el/la más...`。
- **核心词汇 (Vocabulario Clave):**
    -   **未来计划**: 职业规划、学习目标、旅行计划。
    -   **观点与情感**: 我认为、我相信、我希望、我建议、我怀疑。
    -   **健康与生活方式**: 饮食、运动、健康建议。
    -   **工作与面试**: 技能、经验、求职、面试常用语。

---

## 开发日志 (Changelog)

### **2025-10-20 (续): ESLint 配置优化 (ESLint Config Optimization)**
- **目标**: 将 ESLint 配置文件 (`eslint.config.js`) 重构为更简洁、更符合 ESLint v9+ 官方推荐的扁平化配置风格。
- **成果**:
    - 采用了将 `prettierConfig` 作为顶层配置项放置在数组末尾的方式，来禁用与 Prettier 冲突的规则，取代了之前在 `rules` 中手动展开的冗余操作。
    - 新的配置在功能上完全等价，但结构更清晰，可读性与可维护性更高。
    - 通过 `npm run lint:fix` 验证了新配置的有效性并格式化了整个项目。

---

### **2025-10-20: 代码审查与现代化改造 (Code Review & Modernization)**

**核心目标：** 对“西班牙语入门”课程项目进行全面的代码审查、修复关键问题并进行现代化改造，以提升其安全性、稳定性与可维护性。

**主要成果：**
1.  **安全加固**：成功修复了后端语音API中的SSML注入漏洞，杜绝了潜在的安全风险。
2.  **代码质量标准化**：引入了 'ESLint' 和 'Prettier' 工具，建立了代码规范并对整个项目进行了格式化，为未来的开发和维护奠定了坚实的基础。
3.  **技术栈现代化**：将整个前端JavaScript代码库从传统脚本升级为现代ES Modules ('import'/'export')，提升了代码的模块化和组织性。
4.  **关键Bug修复**：解决了在本地开发服务器环境下，因URL路径问题导致的测验功能无法正常计分的问题。
5.  **开发环境优化**：为项目配置了标准的 'npm start' 启动命令，简化了本地开发流程。

**详细历程回顾：**

我们的合作始于一个开放性的代码审查请求。在初步分析中，我们发现了包括后端安全漏洞、前端代码健壮性不足以及缺少代码规范在内的多个待办事项。

1.  **安全先行**：我们首先解决了最紧急的**SSML注入漏洞**，通过对API的输入进行转义，确保了语音合成功能的安全性。
2.  **引入规范**：接着，我们为项目**集成了ESLint和Prettier**。在这个过程中，我们遇到了ESLint v9版本不再支持旧版 '.eslintrc.json' 配置的问题，通过创建新的 'eslint.config.js' 文件，我们成功解决了这个问题，并为项目配置了统一的代码风格。
3.  **走向现代**：为了提升代码质量，我们进行了**ES模块化改造**。这一步虽然让代码结构更清晰，但也引入了新的挑战：浏览器出于安全策略（CORS），禁止了在 `file://` 协议下加载模块。
4.  **攻克本地环境**：
    *   为了解决CORS问题，我们引入了 `serve` 工具来搭建本地服务器，并配置了 `npm start` 命令。
    *   然而，新的环境暴露了两个新问题：**测验逻辑因URL后缀不匹配而失效**，以及**发音功能因 `serve` 无法运行后端API而失灵**。
    *   我们曾尝试使用功能更强大的官方工具 `SWA CLI` 来同时解决这两个问题，但这又触发了您本地Node.js版本过高（v24）与该工具不兼容的深层环境问题。
    *   在讨论了使用Node版本管理器（NVM）的复杂性后，您果断决定，**优先保障线上功能和核心开发体验**。
5.  **回退与聚焦**：我们采纳了您的决定，回退到使用 `serve` 的简单环境。我卸载了 `SWA CLI`，并将 `start` 命令恢复。然后，我们集中精力**修复了测验逻辑的Bug**，使其能够智能处理URL，保证了核心学习功能的正常。
6.  **部署与验证**：最后，我们将所有修复和改进整合到一个Git提交中，并成功推送到GitHub。您通过线上环境的测试，最终确认**语音功能已恢复正常**，证明了我们最初的后端修复是成功的，而本地发音问题确实是开发环境所致。

**当前项目状态：**
*   **线上环境**：功能完整，运行正常。所有安全、逻辑和代码质量的改进均已生效。
*   **本地环境**：使用 `npm start` 启动。除需要后端API的发音功能外，其余功能（包括课程浏览、交互、测验）均可正常使用和开发。这是一个为简化本地环境而接受的已知限制。
*   **代码仓库**：所有修改已合并到 `main` 分支，项目处于一个稳定、健壮且更具可维护性的新阶段。

---

**2025-10-18 (续):**
- **功能修复与代码重构 (Fix & Refactor)**:
    - **修复测验功能**: 重构了测验逻辑，将课程答案从 `main.js` 中分离至 `course-data.js`，彻底解决了第二课测验无法正确计分的问题。
    - **优化课程导航**: 将课程列表数据移入 `course-data.js`，为后续自动化更新导航链接打下基础。
    - **CSS代码规范**: 将 `lesson-02.html` 中的图片行内样式重构为可复用的CSS类，并移入 `style.css` 文件，实现了内容与样式的分离。
    - **格式修复**: 修正了“Ser vs. Estar”一节中误用的Markdown粗体语法。

**2025-10-18 (续):**
- **第二课内容优化 (Lesson 2 Content Optimization)**:
    - **动词变位讲解优化**: 统一了 `-ar`, `-er`, `-ir` 规则动词的讲解结构，为 `-er` 和 `-ir` 动词增加了完整的变位表格及例句，使学习路径更清晰。
    - **语法逻辑顺序调整**: 调整了语法核心部分的讲解顺序，将“反身动词”后移，使语法概念的递进更有逻辑性。
    - **UI清理**: 移除了“随堂测验”中已无实际功能的“提交答案”按钮，简化了界面。

**2025-10-18 (续):**
- **第二课优化：图片集成**：
    - 在“综合情景对话”模块中添加了 `colleagues_conversing.png` 图片，并设置了21:9比例。
    - 在“欢迎来到第二课”模块中添加了 `welcome.png` 图片，并移除了比例限制。

**2025-10-18 (续):**
- **第二课优化：图片集成**：
    - 在“文化角”模块中添加了 `spanish_lunch.jpg` 图片。
    - 调整图片位置至标题下方、内容上方，并增加了圆角和响应式样式。
    - 讨论并决定图片比例暂时保持不变。

**2025-10-18:**
- **第二课开发 (Mi día a día)**：
    - **课程框架搭建**：创建 `lesson-02.html` 并链接到主页 `index.html`。
    - **内容填充**：
        - 欢迎与目标介绍。
        - 语法核心：现在时规则动词变位 (`-ar`, `-er`, `-ir`)。
        - 语法核心：反身动词与日常作息，并增加了“反身动词 vs. 非反身动词”对比环节。
        - 语法核心：关键不规则动词 (`Tener`, `Ir`)。
        - 语法核心：`Ser` vs. `Estar` 的深入讲解。
        - 语法核心：`Gustar` 的特殊用法。
        - 语法核心：情态动词 (`poder`, `querer`, `tener que`)。
        - 词汇模块：日常活动、地点交通、食物饮料。
        - 互动练习：闪卡练习（已扩充词汇量）。
        - 随堂测验。
        - 综合情景对话 (Diálogo Integrado)。
        - 文化角 (Rincón Cultural)：西班牙人的作息时间（已扩充趣味知识）。
        - 总结与课后任务。
    - **结构修复**：修复了 `lesson-02.html` 因误操作导致的HTML结构缺失问题，确保页面样式和交互功能正常。

**2025-10-17:**
- **功能实现：慢速播放**：为所有发音功能增加了慢速播放选项，并最终选定“时钟-减号”作为慢速播放图标。
- **UI/UX 优化**：
    - 在移动端彻底隐藏了计时器工具。
    - 优化了移动端导航栏，通过隐藏页码显示解决了长标题的拥挤问题。
    - 简化了所有“词汇扩充”章节的标题为“词汇”。
- **功能尝试与回退：页面过渡动画**：
    - 尝试为页面切换实现“交叉淡入淡出”效果，并适配不同高度的页面。
    - 由于在高度动态计算上遇到难以解决的顽固bug，为保证项目稳定性，决定放弃此功能。
    - **代码已通过 `git revert` 操作，将线上与本地代码全部回退至无此动画功能的稳定版本。**


**2025-10-13:**
- **UI/UX 体验优化**:
    - 实现顶部固定导航栏，方便在长页面中随时翻页。
    - 重构页面布局为顶部对齐，解决了内容与导航栏的重叠问题及`index`页的空旷感，统一了全站体验。
    - 为移动端设计了可折叠的计时器，默认收起以节省屏幕空间，点击时间可展开。
    - 将翻页按钮的文字替换为 `«` 和 `»` 符号，使界面更简洁。

**2025-10-11:**
- **内容与功能精修**：
    - 恢复了 `lesson-01.html` 的所有原始内容细节，并确保了所有功能（分页、发音、闪卡、测验、计时器等）的完整集成。
    - 修正了“你的职业身份”等页面的内容遗漏。
    - 扩充了“基础生活”、“职业关联”、“高频形容词”等词汇表。
    - 增加了闪卡数量，扩充了测验题目至12题，并修正了题干。
    - 优化了计时器逻辑，调整了颜色阈值（0-60绿，60-100橙，100+红）。
    - 修复了闪卡翻转尺寸和英中分行显示问题。
    - 优化了分页按钮和下拉菜单的样式。
    - 最终版本已部署至GitHub Pages。

**2025-10-11:**
- **确立新方向：课程体系重构**。我们决定将现有的单节课内容，根据成熟的语言教学框架（如CEFR A1标准），拆分为一个循序渐进的、更易于学习的迷你课程系列。

---

## 待办优化列表 (Optimization Backlog)

### 方案：语音体验升级 (专业TTS服务集成)
- **目标**: 将课程网站的发音功能，从不稳定的浏览器内置语音升级为由Azure提供的、高质量、发音统一的专业神经网络语音服务。
- **最终架构**: 采用前后端分离方案。前端静态文件托管于**Azure静态Web应用**的全球CDN。后端API函数同样由静态Web应用承载，通过直接调用**语音服务REST API**的方式提供服务，以确保最佳的兼容性和稳定性。
- **成本**: 利用Azure的永久免费套餐，本项目成本为零。
- **状态**: ✅ **已完成 (Completed)**。
- **历程总结**:
    - 最初计划使用`microsoft-cognitiveservices-speech-sdk`，但在部署过程中遇到了复杂的兼容性问题。
    - **调试过程**: 经历了多次部署失败，从“找不到构建脚本”到“找不到应用产物”，再到API的`404 (Not Found)`和`500 (Internal Server Error)`错误。
    - **问题根源**: 经过反复排查和验证，最终确认核心障碍是`speech-sdk`包的原生依赖与Azure静态Web应用精简的函数运行环境不兼容，导致函数在加载时直接崩溃。
    - **最终方案**: 放弃SDK，改为通过Node.js内置的`https`模块直接调用Azure语音服务的**REST API**，彻底绕开了环境兼容性问题，最终成功实现功能。
    - **核心教训**: 在轻量级Serverless环境中，应优先选择无依赖的REST API方案，而不是可能存在兼容性问题的复杂SDK。

### UI/UX 体验优化 (UI/UX Enhancements)
- [ ] **手势滑动翻页 (Swipe Gesture Navigation)**: 在移动端增加左右滑动切换上一页/下一页的功能。

### 代码模板化 (Code Templating)
- [ ] **目标**: 消除 `lesson-01.html`, `lesson-02.html` 等多个课程页面之间大量重复的HTML代码（如导航栏、页头、页脚等）。
- [ ] **方案**: 创建一个独立的JS文件（如 `templating.js`），用于存放和生成所有页面的公共HTML结构。在每个课程页面中，使用简单的占位符（如 `<header id="header-placeholder"></header>`），然后由JS脚本在页面加载时动态填充这些占位符。
- [ ] **收益**: 极大提升项目的可维护性。未来修改公共部分时，只需修改一个JS文件即可自动应用到所有课程页面。
- [ ] **风险与避坑**: 初次尝试此方案时曾导致页面崩溃。**根本原因**在于：负责创建HTML模板的脚本和负责为模板绑定功能的脚本，两者执行顺序不当，存在“竞争关系”。**必须确保**：模板创建逻辑**严格先于**功能绑定逻辑执行，以避免后者找不到目标元素而出错。


### 1. 丰富互动练习 (Richer Interactive Exercises)
- [x] **发音辅助 (Audio Clips)** - 已完成
- [x] **单词闪卡 (Flashcards)** - 已完成
- [x] **小测验 (Quiz)** - 已完成

### 2. 构建实用语法 (Practical Grammar Building Blocks)
- [ ] **引入核心动词 `Estar`**: 讲解与 `Ser` 的区别。
- [ ] **引入核心动词 `Tener`**: 讲解“拥有”的概念。
- [ ] **引入规则动词**: 讲解 `-ar` 结尾动词的基础变位。

### 3. 融入文化与情境 (Integrating Culture and Context)
- [ ] **文化小贴士**: 介绍西班牙职场文化。
- [ ] **情景对话**: 模拟真实场景。
- [ ] **称谓的艺术**: 讲解 `Tú` (非正式你) vs. `Usted` (正式您) 的用法。

### 4. 深度结合专业领域 (Connecting with the Professional Field)
- [ ] **专业动词**: `conectar`, `instalar`, `reparar`。
- [ ] **真实材料解读**: 选取一段来自 `Iberdrola` 等公司官网的真实句子进行精讲。